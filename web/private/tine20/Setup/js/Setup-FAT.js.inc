/*
 * Tine 2.0 - Setup 
 * Copyright (c) 2007-2011 Metaways Infosystems GmbH (http://www.metaways.de)
 * http://www.gnu.org/licenses/agpl.html AGPL Version 3
 */
Ext.ns("Tine","Tine.Setup");Tine.Tinebase.tineInit.initAjax=Tine.Tinebase.tineInit.initAjax.createInterceptor(function(){Ext.Ajax.timeout=900000;Tine.Tinebase.tineInit.requestUrl="setup.php";return true});Tine.Tinebase.tineInit.initRegistry=Tine.Tinebase.tineInit.initRegistry.createInterceptor(function(){Tine.Tinebase.tineInit.getAllRegistryDataMethod="Setup.getAllRegistryData";Tine.Tinebase.tineInit.stateful=false;return true});Tine.Tinebase.tineInit.checkSelfUpdate=Ext.emptyFn;Tine.Tinebase.tineInit.renderWindow=Tine.Tinebase.tineInit.renderWindow.createInterceptor(function(){var a=Tine.Tinebase.viewport.tineViewportMaincardpanel;if(Tine.Setup.registry.get("configExists")&&!Tine.Setup.registry.get("currentAccount")){if(!Tine.loginPanel){Tine.loginPanel=new Tine.Tinebase.LoginPanel({loginMethod:"Setup.login",loginLogo:"images/tine_logo_setup.png",scope:this,onLogin:function(c){Tine.Tinebase.tineInit.initList.initRegistry=false;Tine.Tinebase.tineInit.initRegistry();var d=function(){if(Tine.Tinebase.tineInit.initList.initRegistry){Ext.MessageBox.hide();Tine.Tinebase.tineInit.renderWindow()}else{d.defer(100)}};d()}});a.layout.container.add(Tine.loginPanel)}a.layout.setActiveItem(Tine.loginPanel.id);Tine.loginPanel.doLayout();return false}var b={accountId:1,accountDisplayName:Tine.Setup.registry.get("currentAccount"),accountLastName:"Admin",accountFirstName:"Setup",accountFullName:"Setup Admin"};Tine.Tinebase.registry.add("currentAccount",b);Tine.Tinebase.registry.add("userApplications",[{name:"Setup",status:"enabled"}]);Tine.Tinebase.MainScreen.prototype.defaultAppName="Setup";Tine.Tinebase.MainScreen.prototype.appPickerStyle="none";return true});Ext.ns("Tine","Tine.Setup");Tine.Setup.TreePanel=Ext.extend(Ext.tree.TreePanel,{border:false,rootVisible:false,initComponent:function(){this.app=Tine.Tinebase.appMgr.get("Setup");var c=!Tine.Setup.registry.get("acceptedTermsVersion")||Tine.Setup.registry.get("acceptedTermsVersion")<Tine.Setup.CurrentTermsVersion;var e=!Tine.Setup.registry.get("setupChecks").success;var b=!Tine.Setup.registry.get("configExists");var d=!Tine.Setup.registry.get("checkDB");var a=Tine.Setup.registry.get("setupRequired");this.root={id:"/",children:[{text:this.app.i18n._("Terms and Conditions"),iconCls:c?"setup_checks_fail":"setup_checks_success",id:"TermsPanel",leaf:true},{text:this.app.i18n._("Setup Checks"),iconCls:e?"setup_checks_fail":"setup_checks_success",disabled:c,id:"EnvCheckGridPanel",leaf:true},{text:this.app.i18n._("Config Manager"),iconCls:"setup_config_manager",disabled:c||e,id:"ConfigManagerPanel",leaf:true},{text:this.app.i18n._("Authentication/Accounts"),iconCls:"setup_authentication_manager",disabled:c||e||b||d,id:"AuthenticationPanel",leaf:true},{text:this.app.i18n._("Email"),iconCls:"action_composeEmail",disabled:c||e||b||d||a,id:"EmailPanel",leaf:true},{text:this.app.i18n._("Application Manager"),iconCls:"setup_application_manager",disabled:c||e||b||d||a,id:"ApplicationGridPanel",leaf:true}]};Tine.Setup.TreePanel.superclass.initComponent.call(this);this.on("click",this.onNodeClick,this)},onNodeClick:function(a){if(!a.disabled){this.app.getMainScreen().activePanel=a.id;this.app.getMainScreen().show()}else{return false}},afterRender:function(){Tine.Setup.TreePanel.superclass.afterRender.call(this);var c="";var a=this.getRootNode().childNodes;for(var b=0;b<a.length;b++){if(!a[b].disabled){c=a[b]}}c.select();this.app.getMainScreen().activePanel=c.id;Tine.Setup.registry.on("replace",this.applyRegistryState,this)},applyRegistryState:function(){var c=Tine.Setup.registry.get("acceptedTermsVersion")>=Tine.Setup.CurrentTermsVersion;var b=Tine.Setup.registry.get("setupChecks").success;var e=Tine.Setup.registry.get("configExists");var d=Tine.Setup.registry.get("checkDB");var a=Tine.Setup.registry.get("setupRequired");this.setNodeIcon("TermsPanel",c);this.setNodeIcon("EnvCheckGridPanel",b);this.getNodeById("EnvCheckGridPanel")[c?"enable":"disable"]();this.getNodeById("ConfigManagerPanel")[c&&b?"enable":"disable"]();this.getNodeById("AuthenticationPanel")[c&&b&&e&&d?"enable":"disable"]();this.getNodeById("ApplicationGridPanel")[c&&b&&e&&d&&!a?"enable":"disable"]();this.getNodeById("EmailPanel")[c&&b&&e&&d&&!a?"enable":"disable"]()},setNodeIcon:function(e,d){var c=this.getNodeById(e);var b=d?"setup_checks_success":"setup_checks_fail";if(c.rendered){var a=Ext.get(c.ui.iconNode);a.removeClass("setup_checks_success");a.removeClass("setup_checks_fail");a.addClass(b)}else{envNode.iconCls=b}}});Ext.ns("Tine","Tine.Setup","Tine.Setup.Model");Tine.Setup.Model.Application=Tine.Tinebase.data.Record.create([{name:"id"},{name:"name"},{name:"status"},{name:"order"},{name:"version"},{name:"current_version"},{name:"install_status"},{name:"depends"}],{appName:"Setup",modelName:"Application",idProperty:"name",titleProperty:"name",recordName:"Application",recordsName:"Applications"});Tine.Setup.ApplicationBackend=new Tine.Tinebase.data.RecordProxy({appName:"Setup",modelName:"Application",recordClass:Tine.Setup.Model.Application});Tine.Setup.Model.EnvCheck=Ext.data.Record.create([{name:"key"},{name:"value"},{name:"message"}]);Ext.ns("Tine","Tine.Setup");Tine.Setup.MainScreen=Ext.extend(Tine.widgets.MainScreen,{activePanel:"EnvCheckGridPanel",showCenterPanel:function(){var a=this.activePanel;if(!this[a]){this[a]=new Tine.Setup[a]({app:this.app})}Tine.Tinebase.MainScreen.setActiveContentPanel(this[a],true);if(this[a].hasOwnProperty("store")){this[a].store.load()}},getCenterPanel:function(){return this[this.activePanel]},showNorthPanel:function(){var a=this.activePanel;if(!this[a+"ActionToolbar"]){this[a+"ActionToolbar"]=this[a].actionToolbar}Tine.Tinebase.MainScreen.setActiveToolbar(this[a+"ActionToolbar"],true);Tine.Tinebase.MainScreen.getMainMenu().action_changePassword.setHidden(true);Tine.Tinebase.MainScreen.getMainMenu().action_showPreferencesDialog.setHidden(true);Tine.Tinebase.MainScreen.getMainMenu().action_editProfile.setDisabled(true)},getWestPanel:function(){if(!this.westPanel){this.westPanel=new Tine.Setup.TreePanel()}return this.westPanel}});Ext.ns("Tine","Tine.Setup");Tine.Setup.CurrentTermsVersion=1;Tine.Setup.TermsPanel=Ext.extend(Ext.Panel,{border:false,layout:"fit",version:1,actionToolbar:null,getLicensePanel:function(){var a=new Ext.form.Checkbox({name:"acceptLicense",xtype:"checkbox",boxLabel:this.app.i18n._("I have read the license agreement and accept it")});this.acceptFields.push(a);return new Ext.Panel({autoScroll:true,layout:"fit",title:this.app.i18n._("License Agreement"),bwrapCfg:{tag:"pre"},autoLoad:{url:"LICENSE",isUpload:true,method:"GET",callback:function(d,c,b){d.update(Ext.util.Format.nl2br(b.responseText))}},bbar:[a]})},getPrivacyPanel:function(){var a=new Ext.form.Checkbox({name:"acceptPrivacy",xtype:"checkbox",boxLabel:this.app.i18n._("I have read the privacy agreement and accept it")});this.acceptFields.push(a);return new Ext.Panel({autoScroll:true,layout:"fit",title:this.app.i18n._("Privacy Agreement"),bwrapCfg:{tag:"pre"},autoLoad:{url:"PRIVACY",isUpload:true,method:"GET",callback:function(d,c,b){d.update(Ext.util.Format.nl2br(b.responseText))}},bbar:[a]})},initActions:function(){this.actionToolbar=new Ext.Toolbar({items:[{text:this.app.i18n._("Accept Terms and Conditions"),iconCls:"setup_checks_success",handler:this.onAcceptConditions,scope:this}]})},initComponent:function(){this.initActions();this.acceptFields=[];this.items=[{layout:"vbox",border:false,layoutConfig:{align:"stretch"},items:[{layout:"fit",border:false,flex:1,items:this.getLicensePanel()},{layout:"fit",border:false,flex:1,items:this.getPrivacyPanel()}]}];this.supr().initComponent.call(this)},onAcceptConditions:function(){var a=true;Ext.each(this.acceptFields,function(b){if(!b.getValue()){b.wrap.setStyle("border-bottom","1px solid red");a=false}else{b.wrap.setStyle("border-bottom","none")}},this);if(a){Tine.Setup.registry.replace("acceptedTermsVersion",Tine.Setup.CurrentTermsVersion)}}});Ext.ns("Tine","Tine.Setup");Tine.Setup.ApplicationGridPanel=Ext.extend(Tine.widgets.grid.GridPanel,{recordClass:Tine.Setup.Model.Application,recordProxy:Tine.Setup.ApplicationBackend,stateful:false,evalGrants:false,defaultSortInfo:{field:"name",dir:"ASC"},gridConfig:{autoExpandColumn:"name"},initComponent:function(){this.gridConfig.columns=this.getColumns();Tine.Setup.ApplicationGridPanel.superclass.initComponent.call(this);this.store.remoteSort=false;this.store.on("load",this.selectApps,this)},getColumns:function(){return[{id:"name",width:350,sortable:true,dataIndex:"name",header:this.app.i18n._("Name")},{id:"status",width:70,sortable:true,dataIndex:"status",header:this.app.i18n._("Enabled"),renderer:this.enabledRenderer},{id:"order",width:50,sortable:true,dataIndex:"order",header:this.app.i18n._("Order")},{id:"version",width:85,sortable:true,dataIndex:"version",header:this.app.i18n._("Installed Version")},{id:"current_version",width:85,sortable:true,dataIndex:"current_version",header:this.app.i18n._("Available Version")},{id:"install_status",width:70,sortable:true,dataIndex:"install_status",header:this.app.i18n._("Status"),renderer:this.upgradeStatusRenderer.createDelegate(this)},{id:"depends",width:150,sortable:true,dataIndex:"depends",header:this.app.i18n._("Depends on")}]},initActions:function(){this.action_installApplications=new Ext.Action({text:this.app.i18n._("Install application"),handler:this.onAlterApplications,actionType:"install",iconCls:"setup_action_install",disabled:true,scope:this});this.action_uninstallApplications=new Ext.Action({text:this.app.i18n._("Uninstall application"),handler:this.onAlterApplications,actionType:"uninstall",iconCls:"setup_action_uninstall",disabled:true,scope:this});this.action_updateApplications=new Ext.Action({text:this.app.i18n._("Update application"),handler:this.onAlterApplications,actionType:"update",iconCls:"setup_action_update",disabled:true,scope:this});this.action_gotoLogin=new Ext.Action({text:String.format(this.app.i18n._("Go to {0} login"),Tine.title),handler:this.onGotoLogin,iconCls:"action_login",scope:this});this.actions=[this.action_installApplications,this.action_uninstallApplications,this.action_updateApplications,"-",this.action_gotoLogin];this.actionToolbar=new Ext.Toolbar({split:false,height:26,items:this.actions});this.contextMenu=new Ext.menu.Menu({items:this.actions})},initGrid:function(){Tine.Setup.ApplicationGridPanel.superclass.initGrid.call(this);this.selectionModel.purgeListeners();this.selectionModel.on("selectionchange",this.onSelectionChange,this)},onSelectionChange:function(b){var a=b.getSelections();var e=b.getCount()==0;var j=e,g=e,h=e,l,k,c;for(var f=0;f<a.length;f++){var d=a[f].get("install_status");j=j||d=="uptodate"||d=="updateable";g=g||d=="uptodate"||d=="uninstalled";h=h||d=="uninstalled";if(a[f].id=="Addressbook"){l=true}else{if(a[f].id=="Tinebase"){c=true}else{if(a[f].id=="Admin"){k=true}}}}if(this.store.getById("Tinebase").get("install_status")=="uninstalled"){c=false}if((l||k)&&!c){h=true}this.action_installApplications.setDisabled(j);this.action_uninstallApplications.setDisabled(h);this.action_updateApplications.setDisabled(g)},onAlterApplications:function(a,b){if(a.actionType=="uninstall"){Ext.Msg.confirm(this.app.i18n._("uninstall"),this.app.i18n._("Do you really want to uninstall the application(s)?"),function(c,d){if(c=="yes"){this.alterApps(a.actionType)}},this)}else{this.alterApps(a.actionType)}},onGotoLogin:function(a,b){window.location=window.location.href.replace(/setup(\.php)*/,"")},selectApps:function(){var a=[];this.store.each(function(b){if(b.get("install_status")=="updateable"){a.push(b)}},this);this.selectionModel.selectRecords(a)},alterApps:function(b){var d=[];var c=this.selectionModel.getSelections();for(var a=0;a<c.length;a++){d.push(c[a].get("name"))}this.sendAlterApplicationsRequest(b,d,null)},sendAlterApplicationsRequest:function(c,d,a){var e=this.app.i18n.n_('Updating Application "{0}".',"Updating {0} Applications.",d.length);e=String.format(e,d.length==1?d[0]:d.length)+" "+this.app.i18n._("This may take a while");var b=new Ext.LoadMask(this.grid.getEl(),{msg:e,removeMask:true});b.show();Ext.Ajax.request({scope:this,params:{method:"Setup."+c+"Applications",applicationNames:d,options:a},success:function(f){var g=Ext.util.JSON.decode(f.responseText);for(key in g){if(key!="status"&&key!="success"){Tine.Setup.registry.replace(key,g[key])}}this.store.load();b.hide()},failure:function(f){b.hide();switch(f.code){case 501:Ext.MessageBox.show({title:this.app.i18n._("Dependency Violation"),msg:data.msg,buttons:Ext.Msg.OK,icon:Ext.MessageBox.WARNING});this.store.load();break;default:Tine.Tinebase.ExceptionHandler.handleRequestException(f)}}})},enabledRenderer:function(a){return Tine.Tinebase.common.booleanRenderer(a=="enabled")},upgradeStatusRenderer:function(a){return this.app.i18n._hidden(a)}});Ext.ns("Tine","Tine.Setup");Tine.Setup.EnvCheckGridPanel=Ext.extend(Ext.Panel,{actionToolbar:null,contextMenu:null,layout:"border",border:false,gridConfig:{autoExpandColumn:"key"},initComponent:function(){this.gridConfig.columns=this.getColumns();this.initActions();this.initStore();this.initGrid();this.initLayout();Tine.Setup.EnvCheckGridPanel.superclass.initComponent.call(this)},initStore:function(){this.store=new Ext.data.JsonStore({fields:Tine.Setup.Model.EnvCheck,mode:"local",id:"key",remoteSort:false});this.store.on("beforeload",function(){if(!this.loadMask){this.loadMask=new Ext.LoadMask(this.el,{msg:this.app.i18n._("Performing Environment Checks...")})}this.loadMask.show();Ext.Ajax.request({params:{method:"Setup.envCheck"},scope:this,success:function(b){var c=Ext.util.JSON.decode(b.responseText);Tine.Setup.registry.replace("setupChecks",c);this.store.loadData(c.results);this.loadMask.hide()}});return false},this);var a=Tine.Setup.registry.get("setupChecks").results;this.store.loadData(a)},initGrid:function(){this.selectionModel=new Ext.grid.RowSelectionModel({store:this.store});var a=new Ext.grid.GridView({autoFill:true,forceFit:true,ignoreAdd:true});this.grid=new Ext.grid.GridPanel(Ext.applyIf(this.gridConfig,{border:false,store:this.store,sm:this.selectionModel,view:a}))},getColumns:function(){return[{id:"key",width:150,sortable:true,dataIndex:"key",header:this.app.i18n._("Check")},{id:"value",width:50,sortable:true,dataIndex:"value",header:this.app.i18n._("Result"),renderer:this.resultRenderer},{id:"message",width:600,sortable:true,dataIndex:"message",header:this.app.i18n._("Error"),renderer:this.messageRenderer}]},resultRenderer:function(b){var a=(b)?"images/oxygen/16x16/actions/dialog-apply.png":"images/oxygen/16x16/actions/dialog-cancel.png";return'<img class="TasksMainGridStatus" src="'+a+'">'},messageRenderer:function(a){return a},initActions:function(){this.action_reCheck=new Ext.Action({text:this.app.i18n._("Run setup tests"),handler:function(){this.store.load({})},iconCls:"x-tbar-loading",scope:this});this.action_ignoreTests=new Ext.Action({text:this.app.i18n._("Ignore setup tests"),disabled:true,iconCls:"setup_checks_success",scope:this,handler:function(){var a=Tine.Setup.registry.get("setupChecks");a.success=true;Tine.Setup.registry.replace("setupChecks",a);Tine.Setup.registry.replace("checkDB",true)}});this.actionToolbar=new Ext.Toolbar({items:[this.action_reCheck,this.action_ignoreTests]})},initLayout:function(){this.items=[{region:"center",xtype:"panel",layout:"fit",border:false,items:this.grid}]}});Ext.ns("Tine","Tine.Setup");Tine.Setup.ConfigManagerPanel=Ext.extend(Tine.Tinebase.widgets.form.ConfigPanel,{idPrefix:null,saveMethod:"Setup.saveConfig",registryKey:"configData",defaults:{xtype:"fieldset",autoHeight:"auto",defaults:{width:300},defaultType:"textfield"},sessionBackendIdPrefix:null,tabIndexCounter:1,initComponent:function(){this.idPrefix=Ext.id();this.sessionBackendIdPrefix=this.idPrefix+"-sessionBackend-";Tine.Setup.ConfigManagerPanel.superclass.initComponent.call(this)},onChangeSessionBackend:function(){this.changeCard(this.sessionBackendCombo,this.sessionBackendIdPrefix)},onChangeSqlBackend:function(){},onRender:function(b,a){Tine.Setup.EmailPanel.superclass.onRender.call(this,b,a);this.onChangeSessionBackend.defer(250,this)},getTabIndex:function(){return this.tabIndexCounter++},getFormItems:function(){var a={xtype:"combo",listWidth:300,mode:"local",forceSelection:true,allowEmpty:false,triggerAction:"all",editable:false,tabIndex:this.getTabIndex};this.sessionBackendCombo=new Ext.form.ComboBox(Ext.applyIf({name:"session_backend",fieldLabel:this.app.i18n._("Backend"),value:"File",store:[["File",this.app.i18n._("File")]],listeners:{scope:this,change:this.onChangeSessionBackend,select:this.onChangeSessionBackend}},a));this.sqlBackendCombo=new Ext.form.ComboBox(Ext.applyIf({name:"database_adapter",fieldLabel:this.app.i18n._("Adapter"),value:"pdo_mysql",store:[["pdo_mysql","MySQL"],["pdo_pgsql","PostgreSQL"],["oracle","Oracle"]],listeners:{scope:this,change:this.onChangeSqlBackend,select:this.onChangeSqlBackend}},a));return[{title:this.app.i18n._("Setup Authentication"),defaults:{width:300,tabIndex:this.getTabIndex},items:[{name:"setupuser_username",fieldLabel:this.app.i18n._("Username"),allowBlank:false,listeners:{afterrender:function(b){b.focus(true,500)}}},{name:"setupuser_password",fieldLabel:this.app.i18n._("Password"),inputType:"password",allowBlank:false}]},{title:this.app.i18n._("Database"),id:"setup-database-group",defaults:{width:300,tabIndex:this.getTabIndex},items:[this.sqlBackendCombo,{name:"database_host",fieldLabel:this.app.i18n._("Hostname"),allowBlank:false},{xtype:"numberfield",name:"database_port",fieldLabel:this.app.i18n._("Port")},{name:"database_dbname",fieldLabel:this.app.i18n._("Database"),allowBlank:false},{name:"database_username",fieldLabel:this.app.i18n._("User"),allowBlank:false},{name:"database_password",fieldLabel:this.app.i18n._("Password"),inputType:"password"},{name:"database_tableprefix",fieldLabel:this.app.i18n._("Prefix")}]},{title:this.app.i18n._("Logging"),id:"setup-logger-group",checkboxToggle:true,collapsed:true,defaults:{width:300,tabIndex:this.getTabIndex},items:[{name:"logger_filename",fieldLabel:this.app.i18n._("Filename")},Ext.applyIf({name:"logger_priority",fieldLabel:this.app.i18n._("Priority"),store:[[0,"Emergency"],[1,"Alert"],[2,"Critical"],[3,"Error"],[4,"Warning"],[5,"Notice"],[6,"Informational"],[7,"Debug"],[8,"Trace"]]},a)]},{title:this.app.i18n._("Caching"),id:"setup-caching-group",checkboxToggle:true,collapsed:true,defaults:{width:300,tabIndex:this.getTabIndex},items:[{name:"caching_path",fieldLabel:this.app.i18n._("Path")},{xtype:"numberfield",name:"caching_lifetime",fieldLabel:this.app.i18n._("Lifetime (seconds)"),minValue:0,maxValue:3600}]},{title:this.app.i18n._("Temporary files"),id:"setup-tmpDir-group",defaults:{width:300,tabIndex:this.getTabIndex},items:[{name:"tmpdir",fieldLabel:this.app.i18n._("Temporary Files Path"),value:Tine.Setup.registry.get(this.registryKey).tmpdir}]},{title:this.app.i18n._("Session"),id:"setup-session-group",defaults:{width:300,tabIndex:this.getTabIndex},items:[{name:"session_lifetime",fieldLabel:this.app.i18n._("Lifetime (seconds)"),xtype:"numberfield",value:86400,minValue:0},this.sessionBackendCombo,{id:this.sessionBackendIdPrefix+"CardLayout",xtype:"panel",layout:"card",activeItem:this.sessionBackendIdPrefix+"File",border:false,width:"100%",defaults:{border:false},items:[{id:this.sessionBackendIdPrefix+"File",layout:"form",autoHeight:"auto",defaults:{width:300,xtype:"textfield",tabIndex:this.getTabIndex},items:[{name:"session_path",fieldLabel:this.app.i18n._("Path")}]},{id:this.sessionBackendIdPrefix+"Redis",layout:"form",autoHeight:"auto",defaults:{width:300,xtype:"textfield",tabIndex:this.getTabIndex},items:[{name:"session_host",fieldLabel:this.app.i18n._("Hostname"),value:"localhost"},{name:"session_port",fieldLabel:this.app.i18n._("Port"),xtype:"numberfield",minValue:0,value:6379}]}]}]},{title:this.app.i18n._("Filestore directory"),id:"setup-filesDir-group",defaults:{width:300,tabIndex:this.getTabIndex},items:[{name:"filesdir",fieldLabel:this.app.i18n._("Filestore Path"),value:Tine.Setup.registry.get(this.registryKey)["filesdir"]}]},{title:this.app.i18n._("Addressbook Map panel"),defaults:{width:300,tabIndex:this.getTabIndex},items:[Ext.applyIf({name:"mapPanel",fieldLabel:this.app.i18n._("Map panel"),value:Tine.Setup.registry.get(this.registryKey)["mapPanel"],store:[[0,this.app.i18n._("disabled")],[1,this.app.i18n._("enabled")]]},a)]}]},applyRegistryState:function(){this.action_saveConfig.setDisabled(!Tine.Setup.registry.get("configWritable"));if(!Tine.Setup.registry.get("configWritable")){this.action_saveConfig.setText(this.app.i18n._("Config file is not writable"))}else{this.action_saveConfig.setText(this.app.i18n._("Save config"))}Ext.getCmp("setup-database-group").setIconClass(Tine.Setup.registry.get("checkDB")?"setup_checks_success":"setup_checks_fail");Ext.getCmp("setup-logger-group").setIconClass(Tine.Setup.registry.get("checkLogger")?"setup_checks_success":"setup_checks_fail");Ext.getCmp("setup-caching-group").setIconClass(Tine.Setup.registry.get("checkCaching")?"setup_checks_success":"setup_checks_fail");Ext.getCmp("setup-tmpDir-group").setIconClass(Tine.Setup.registry.get("checkTmpDir")?"setup_checks_success":"setup_checks_fail");Ext.getCmp("setup-session-group").setIconClass(Tine.Setup.registry.get("checkSessionDir")?"setup_checks_success":"setup_checks_fail");Ext.getCmp("setup-filesDir-group").setIconClass(Tine.Setup.registry.get("checkFilesDir")?"setup_checks_success":"setup_checks_fail")},initActions:function(){this.action_downloadConfig=new Ext.Action({text:this.app.i18n._("Download config file"),iconCls:"setup_action_download_config",scope:this,handler:this.onDownloadConfig});this.actionToolbarItems=[this.action_downloadConfig];Tine.Setup.ConfigManagerPanel.superclass.initActions.apply(this,arguments)},onDownloadConfig:function(){if(this.isValid()){var a=this.form2config();var b=new Ext.ux.file.Download({url:Tine.Tinebase.tineInit.requestUrl,params:{method:"Setup.downloadConfig",data:Ext.encode(a)}});b.start()}else{this.alertInvalidData()}}});Ext.ns("Tine","Tine.Setup");Tine.Setup.AuthenticationPanel=Ext.extend(Tine.Tinebase.widgets.form.ConfigPanel,{idPrefix:null,authProviderIdPrefix:null,accountsStorageIdPrefix:null,authenticationBackendCombo:null,accountsStorageCombo:null,originalAccountsStorage:null,saveMethod:"Setup.saveAuthentication",registryKey:"authenticationData",tabIndexCounter:1,initComponent:function(){this.idPrefix=Ext.id();this.authProviderIdPrefix=this.idPrefix+"-authProvider-";this.accountsStorageIdPrefix=this.idPrefix+"-accountsStorage-";this.originalAccountsStorage=(Tine.Setup.registry.get(this.registryKey).accounts)?Tine.Setup.registry.get(this.registryKey).accounts.backend:"Sql";Tine.Setup.AuthenticationPanel.superclass.initComponent.call(this)},onChangeAuthProvider:function(){var b=this.authenticationBackendCombo.getValue();var a=Ext.getCmp(this.authProviderIdPrefix+"CardLayout").getLayout();a.setActiveItem(this.authProviderIdPrefix+b)},onChangeAccountsStorage:function(){var a=this.accountsStorageCombo.getValue();if(a==="Ldap"&&a!==this.originalAccountsStorage){Ext.Msg.confirm(this.app.i18n._("Delete all existing users and groups"),this.app.i18n._("Switching from SQL to LDAP will delete all existing User Accounts, Groups and Roles. Do you really want to switch the accounts storage backend to LDAP ?"),function(b,c){if(b==="yes"){this.doOnChangeAccountsStorage(a)}else{this.accountsStorageCombo.setValue(this.originalAccountsStorage)}},this)}else{this.doOnChangeAccountsStorage(a)}},doOnChangeAccountsStorage:function(b){var a=Ext.getCmp(this.accountsStorageIdPrefix+"CardLayout").getLayout();a.setActiveItem(this.accountsStorageIdPrefix+b);this.originalAccountsStorage=b},onRender:function(b,a){Tine.Setup.AuthenticationPanel.superclass.onRender.call(this,b,a);this.onChangeAuthProvider.defer(250,this);this.onChangeAccountsStorage.defer(250,this)},form2config:function(){var a=this.supr().form2config.call(this);a.acceptedTermsVersion=Tine.Setup.registry.get("acceptedTermsVersion");return a},getTabIndex:function(){return this.tabIndexCounter++},getFormItems:function(){var a=Tine.Setup.registry.get("setupRequired");var b={xtype:"combo",listWidth:300,mode:"local",forceSelection:true,allowEmpty:false,triggerAction:"all",editable:false,tabIndex:this.getTabIndex};this.authenticationBackendCombo=new Ext.form.ComboBox(Ext.applyIf({name:"authentication_backend",fieldLabel:this.app.i18n._("Backend"),store:[["Sql","Sql"],["Ldap","Ldap"],["Imap","IMAP"]],value:"Sql",width:300,listeners:{scope:this,change:this.onChangeAuthProvider,select:this.onChangeAuthProvider}},b));this.accountsStorageCombo=new Ext.form.ComboBox(Ext.applyIf({name:"accounts_backend",fieldLabel:this.app.i18n._("Backend"),store:[["Sql","Sql"],["Ldap","Ldap"]],value:"Sql",width:300,listeners:{scope:this,change:this.onChangeAccountsStorage,select:this.onChangeAccountsStorage}},b));return[{xtype:"fieldset",collapsible:true,collapsed:!a,autoHeight:true,title:this.app.i18n._("Initial Admin User"),items:[{layout:"form",autoHeight:"auto",border:false,defaults:{width:300,xtype:"textfield",inputType:"password",tabIndex:this.getTabIndex},items:[{name:"authentication_Sql_adminLoginName",fieldLabel:this.app.i18n._("Initial admin login name"),inputType:"text",disabled:!a},{name:"authentication_Sql_adminPassword",fieldLabel:this.app.i18n._("Initial admin Password"),disabled:!a},{name:"authentication_Sql_adminPasswordConfirmation",fieldLabel:this.app.i18n._("Password confirmation"),disabled:!a}]}]},{xtype:"fieldset",collapsible:false,autoHeight:true,title:this.app.i18n._("Authentication provider"),items:[this.authenticationBackendCombo,{id:this.authProviderIdPrefix+"CardLayout",layout:"card",activeItem:this.authProviderIdPrefix+"Sql",border:false,defaults:{border:false},items:[{id:this.authProviderIdPrefix+"Sql",layout:"form",autoHeight:"auto",defaults:{width:300,xtype:"textfield",tabIndex:this.getTabIndex},items:[Ext.applyIf({name:"authentication_Sql_tryUsernameSplit",fieldLabel:this.app.i18n._("Try to split username"),store:[["1",this.app.i18n._("Yes")],["0",this.app.i18n._("No")]],value:"1"},b),Ext.applyIf({name:"authentication_Sql_accountCanonicalForm",fieldLabel:this.app.i18n._("Account canonical form"),store:[["2","ACCTNAME_FORM_USERNAME"],["3","ACCTNAME_FORM_BACKSLASH"],["4","ACCTNAME_FORM_PRINCIPAL"]],value:"2"},b),{name:"authentication_Sql_accountDomainName",fieldLabel:this.app.i18n._("Account domain name ")},{name:"authentication_Sql_accountDomainNameShort",fieldLabel:this.app.i18n._("Account domain short name")}]},{id:this.authProviderIdPrefix+"Ldap",layout:"form",autoHeight:"auto",defaults:{width:300,xtype:"textfield",tabIndex:this.getTabIndex},items:[{name:"authentication_Ldap_host",fieldLabel:this.app.i18n._("Host")},{name:"authentication_Ldap_username",fieldLabel:this.app.i18n._("Login name")},{name:"authentication_Ldap_password",fieldLabel:this.app.i18n._("Password"),inputType:"password"},Ext.applyIf({name:"authentication_Ldap_bindRequiresDn",fieldLabel:this.app.i18n._("Bind requires DN"),store:[["1",this.app.i18n._("Yes")],["0",this.app.i18n._("No")]],value:"1"},b),{name:"authentication_Ldap_baseDn",fieldLabel:this.app.i18n._("Base DN")},{name:"authentication_Ldap_accountFilterFormat",fieldLabel:this.app.i18n._("Search filter")},Ext.applyIf({name:"authentication_Ldap_accountCanonicalForm",fieldLabel:this.app.i18n._("Account canonical form"),store:[["2","ACCTNAME_FORM_USERNAME"],["3","ACCTNAME_FORM_BACKSLASH"],["4","ACCTNAME_FORM_PRINCIPAL"]],value:"2"},b),{name:"authentication_Ldap_accountDomainName",fieldLabel:this.app.i18n._("Account domain name ")},{name:"authentication_Ldap_accountDomainNameShort",fieldLabel:this.app.i18n._("Account domain short name")}]},{id:this.authProviderIdPrefix+"Imap",layout:"form",autoHeight:"auto",defaults:{width:300,xtype:"textfield",tabIndex:this.getTabIndex},items:[{name:"authentication_Imap_host",fieldLabel:this.app.i18n._("Hostname")},{name:"authentication_Imap_port",fieldLabel:this.app.i18n._("Port"),xtype:"numberfield"},Ext.applyIf({fieldLabel:this.app.i18n._("Secure Connection"),name:"authentication_Imap_ssl",store:[["none",this.app.i18n._("None")],["tls",this.app.i18n._("TLS")],["ssl",this.app.i18n._("SSL")]],value:"none"},b),{name:"authentication_Imap_domain",fieldLabel:this.app.i18n._("Append domain to login name")}]}]}]},{xtype:"fieldset",collapsible:false,autoHeight:true,title:this.app.i18n._("Accounts storage"),items:[this.accountsStorageCombo,{id:this.accountsStorageIdPrefix+"CardLayout",layout:"card",activeItem:this.accountsStorageIdPrefix+"Sql",border:false,defaults:{border:false},items:[{id:this.accountsStorageIdPrefix+"Sql",layout:"form",autoHeight:"auto",defaults:{width:300,xtype:"textfield",tabIndex:this.getTabIndex},items:[{name:"accounts_Sql_defaultUserGroupName",fieldLabel:this.app.i18n._("Default user group name")},{name:"accounts_Sql_defaultAdminGroupName",fieldLabel:this.app.i18n._("Default admin group name")}]},{id:this.accountsStorageIdPrefix+"Ldap",layout:"form",autoHeight:"auto",defaults:{width:300,xtype:"textfield",tabIndex:this.getTabIndex},items:[{name:"accounts_Ldap_host",fieldLabel:this.app.i18n._("Host")},{name:"accounts_Ldap_username",fieldLabel:this.app.i18n._("Login name")},{name:"accounts_Ldap_password",fieldLabel:this.app.i18n._("Password"),inputType:"password"},Ext.applyIf({name:"accounts_Ldap_bindRequiresDn",fieldLabel:this.app.i18n._("Bind requires DN"),store:[["1",this.app.i18n._("Yes")],["0",this.app.i18n._("No")]],value:"1"},b),{name:"accounts_Ldap_userDn",fieldLabel:this.app.i18n._("User DN")},{name:"accounts_Ldap_userFilter",fieldLabel:this.app.i18n._("User Filter")},Ext.applyIf({name:"accounts_Ldap_userSearchScope",fieldLabel:this.app.i18n._("User Search Scope"),store:[["1","SEARCH_SCOPE_SUB"],["2","SEARCH_SCOPE_ONE"]],value:"1"},b),{name:"accounts_Ldap_groupsDn",fieldLabel:this.app.i18n._("Groups DN")},{name:"accounts_Ldap_groupFilter",fieldLabel:this.app.i18n._("Group Filter")},Ext.applyIf({name:"accounts_Ldap_groupSearchScope",fieldLabel:this.app.i18n._("Group Search Scope"),store:[["1","SEARCH_SCOPE_SUB"],["2","SEARCH_SCOPE_ONE"]],value:"1"},b),Ext.applyIf({name:"accounts_Ldap_pwEncType",fieldLabel:this.app.i18n._("Password encoding"),store:[["CRYPT","CRYPT"],["SHA","SHA"],["MD5","MD5"]],value:"CRYPT"},b),Ext.applyIf({name:"accounts_Ldap_useRfc2307bis",fieldLabel:this.app.i18n._("Use Rfc 2307 bis"),store:[["0",this.app.i18n._("No")],["1",this.app.i18n._("Yes")]],value:"0"},b),{name:"accounts_Ldap_minUserId",fieldLabel:this.app.i18n._("Min User Id")},{name:"accounts_Ldap_maxUserId",fieldLabel:this.app.i18n._("Max User Id")},{name:"accounts_Ldap_minGroupId",fieldLabel:this.app.i18n._("Min Group Id")},{name:"accounts_Ldap_maxGroupId",fieldLabel:this.app.i18n._("Max Group Id")},{name:"accounts_Ldap_groupUUIDAttribute",fieldLabel:this.app.i18n._("Group UUID Attribute name")},{name:"accounts_Ldap_userUUIDAttribute",fieldLabel:this.app.i18n._("User UUID Attribute name")},{name:"accounts_Ldap_defaultUserGroupName",fieldLabel:this.app.i18n._("Default user group name")},{name:"accounts_Ldap_defaultAdminGroupName",fieldLabel:this.app.i18n._("Default admin group name")},Ext.applyIf({name:"accounts_Ldap_readonly",fieldLabel:this.app.i18n._("Readonly access"),store:[["0",this.app.i18n._("No")],["1",this.app.i18n._("Yes")]],value:"0"},b)]}]}]},{xtype:"fieldset",collapsible:false,autoHeight:true,title:this.app.i18n._("Password Settings"),defaults:{width:300,xtype:"uxspinner",tabIndex:this.getTabIndex,strategy:{xtype:"number",minValue:0,maxValue:64},value:0},items:[Ext.applyIf({name:"password_changepw",fieldLabel:this.app.i18n._("User can change password"),store:[[1,this.app.i18n._("Yes")],[0,this.app.i18n._("No")]],value:1},b),Ext.applyIf({name:"password_pwPolicyActive",fieldLabel:this.app.i18n._("Enable password policy"),store:[[1,this.app.i18n._("Yes")],[0,this.app.i18n._("No")]],value:0},b),Ext.applyIf({name:"password_pwPolicyOnlyASCII",fieldLabel:this.app.i18n._("Only ASCII"),store:[[1,this.app.i18n._("Yes")],[0,this.app.i18n._("No")]],value:0},b),{name:"password_pwPolicyMinLength",fieldLabel:this.app.i18n._("Minimum length")},{name:"password_pwPolicyMinWordChars",fieldLabel:this.app.i18n._("Minimum word chars")},{name:"password_pwPolicyMinUppercaseChars",fieldLabel:this.app.i18n._("Minimum uppercase chars")},{name:"password_pwPolicyMinSpecialChars",fieldLabel:this.app.i18n._("Minimum special chars")},{name:"password_pwPolicyMinNumbers",fieldLabel:this.app.i18n._("Minimum numbers")}]},{xtype:"fieldset",collapsible:false,autoHeight:true,title:this.app.i18n._("Redirect Settings"),defaults:{width:300,xtype:"textfield",tabIndex:this.getTabIndex},items:[{name:"redirectSettings_redirectUrl",fieldLabel:this.app.i18n._("Redirect Url (redirect to login screen if empty)")},Ext.applyIf({name:"redirectSettings_redirectAlways",fieldLabel:this.app.i18n._("Redirect Always (if No, only redirect after logout)"),store:[["1",this.app.i18n._("Yes")],["0",this.app.i18n._("No")]],value:"0"},b),Ext.applyIf({name:"redirectSettings_redirectToReferrer",fieldLabel:this.app.i18n._("Redirect to referring site, if exists"),store:[["1",this.app.i18n._("Yes")],["0",this.app.i18n._("No")]],value:"0"},b)]}]},applyRegistryState:function(){this.action_saveConfig.setDisabled(false);if(Tine.Setup.registry.get("setupRequired")){this.action_saveConfig.setText(this.app.i18n._("Save config and install"))}else{this.action_saveConfig.setText(this.app.i18n._("Save config"));this.getForm().findField("authentication_Sql_adminPassword").setDisabled(true);this.getForm().findField("authentication_Sql_adminPasswordConfirmation").setDisabled(true);this.getForm().findField("authentication_Sql_adminLoginName").setDisabled(true)}},isValid:function(){var b=this.getForm();var a=b.isValid();if(this.authenticationBackendCombo.getValue()==="Sql"&&b.findField("authentication_Sql_adminPassword")&&b.findField("authentication_Sql_adminPassword").getValue()!==b.findField("authentication_Sql_adminPasswordConfirmation").getValue()){b.markInvalid([{id:"authentication_Sql_adminPasswordConfirmation",msg:this.app.i18n._("Passwords don't match")}]);a=false}if(Tine.Setup.registry.get("setupRequired")&&b.findField("authentication_Sql_adminLoginName")){if(Ext.isEmpty(b.findField("authentication_Sql_adminLoginName").getValue())){b.markInvalid([{id:"authentication_Sql_adminLoginName",msg:this.app.i18n._("Should not be empty")}]);a=false}if(Ext.isEmpty(b.findField("authentication_Sql_adminPassword").getValue())){b.markInvalid([{id:"authentication_Sql_adminPassword",msg:this.app.i18n._("Should not be empty")}]);b.markInvalid([{id:"authentication_Sql_adminPasswordConfirmation",msg:this.app.i18n._("Should not be empty")}]);a=false}}if(this.accountsStorageCombo.getValue()==="Sql"&&b.findField("accounts_Sql_defaultUserGroupName")&&Ext.isEmpty(b.findField("accounts_Sql_defaultUserGroupName").getValue())){b.markInvalid([{id:"accounts_Sql_defaultUserGroupName",msg:this.app.i18n._("Should not be empty")}]);a=false}if(this.accountsStorageCombo.getValue()==="Sql"&&b.findField("accounts_Sql_defaultAdminGroupName")&&Ext.isEmpty(b.findField("accounts_Sql_defaultAdminGroupName").getValue())){b.markInvalid([{id:"accounts_Sql_defaultAdminGroupName",msg:this.app.i18n._("Should not be empty")}]);a=false}return a}});Ext.ns("Tine","Tine.Setup");Tine.Setup.EmailPanel=Ext.extend(Tine.Tinebase.widgets.form.ConfigPanel,{idPrefix:null,imapBackendIdPrefix:null,imapBackendCombo:null,smtpBackendIdPrefix:null,smtpBackendCombo:null,showType:false,saveMethod:"Setup.saveEmailConfig",registryKey:"emailData",defaults:{xtype:"fieldset",autoHeight:"auto",defaults:{width:300}},initComponent:function(){this.idPrefix=Ext.id();this.imapBackendIdPrefix=this.idPrefix+"-imapBackend-";this.smtpBackendIdPrefix=this.idPrefix+"-smtpBackend-";Tine.Setup.EmailPanel.superclass.initComponent.call(this)},onChangeImapBackend:function(){this.changeCard(this.imapBackendCombo,this.imapBackendIdPrefix)},onChangeSmtpBackend:function(){this.changeCard(this.smtpBackendCombo,this.smtpBackendIdPrefix)},onRender:function(b,a){Tine.Setup.EmailPanel.superclass.onRender.call(this,b,a);this.onChangeImapBackend.defer(250,this);this.onChangeSmtpBackend.defer(250,this)},getFormItems:function(){var b={xtype:"combo",width:300,listWidth:300,mode:"local",forceSelection:true,allowEmpty:false,triggerAction:"all",editable:false,value:"standard",fieldLabel:this.app.i18n._("Backend")};b.store=[["standard",this.app.i18n._("Standard IMAP")],["dbmail","DBmail  MySQL"],["ldap_imap","DBmail Ldap"],["cyrus","Cyrus"],["dovecot_imap","Dovecot MySQL"]];b.name="imap_backend";b.listeners={scope:this,change:this.onChangeImapBackend,select:this.onChangeImapBackend};this.imapBackendCombo=new Ext.form.ComboBox(b);b.store=[["standard",this.app.i18n._("Standard SMTP")],["postfix","Postfix MySQL"],["Ldapsmtpmail","Ldap (only mail attribute)"],["ldapSmtp","Postfix Ldap (dbmail schema)"],["ldapSmtpQmail","Postfix Ldap (qmail schema)"]];b.name="smtp_backend";b.listeners={scope:this,change:this.onChangeSmtpBackend,select:this.onChangeSmtpBackend};this.smtpBackendCombo=new Ext.form.ComboBox(b);var a=b;delete a.listeners;return[{title:this.app.i18n._("Imap"),id:"setup-imap-group",checkboxToggle:true,collapsed:true,items:[this.imapBackendCombo,{name:"imap_host",fieldLabel:this.app.i18n._("Hostname"),xtype:"textfield"},{name:"imap_port",fieldLabel:this.app.i18n._("Port"),xtype:"numberfield"},Ext.applyIf({fieldLabel:this.app.i18n._("Secure Connection"),name:"imap_ssl",value:"none",store:[["none",this.app.i18n._("None")],["tls",this.app.i18n._("TLS")],["ssl",this.app.i18n._("SSL")]]},a),Ext.applyIf({name:"imap_useSystemAccount",fieldLabel:this.app.i18n._("Use system account"),store:[[0,this.app.i18n._("No")],[1,this.app.i18n._("Yes")]],value:0},a),{name:"imap_domain",fieldLabel:this.app.i18n._("Append domain to login name"),xtype:"textfield"},{id:this.imapBackendIdPrefix+"CardLayout",layout:"card",activeItem:this.imapBackendIdPrefix+"standard",border:false,width:"100%",defaults:{border:false},items:[{id:this.imapBackendIdPrefix+"standard",layout:"form",items:[]},{id:this.imapBackendIdPrefix+"dbmail",layout:"form",autoHeight:"auto",defaults:{width:300,xtype:"textfield"},items:this.getDbConfigFields("imap","dbmail")},{id:this.imapBackendIdPrefix+"ldap_imap",layout:"form",defaults:{width:300,xtype:"textfield"},items:[]},{id:this.imapBackendIdPrefix+"cyrus",layout:"form",autoHeight:"auto",defaults:{width:300,xtype:"textfield"},items:[{name:"imap_cyrus_admin",fieldLabel:this.app.i18n._("Cyrus Admin")},{name:"imap_cyrus_password",fieldLabel:this.app.i18n._("Cyrus Admin Password"),inputType:"password"}]},{id:this.imapBackendIdPrefix+"dovecot_imap",layout:"form",autoHeight:"auto",defaults:{width:300,xtype:"textfield"},items:this.getDbConfigFields("imap","dovecot").concat(this.getDovecotExtraConfig("imap"))}]}]},{title:this.app.i18n._("Smtp"),id:"setup-smtp-group",checkboxToggle:true,collapsed:true,items:[this.smtpBackendCombo,{name:"smtp_hostname",fieldLabel:this.app.i18n._("Hostname"),xtype:"textfield"},{name:"smtp_port",fieldLabel:this.app.i18n._("Port"),xtype:"numberfield"},Ext.applyIf({fieldLabel:this.app.i18n._("Secure Connection"),name:"smtp_ssl",value:"none",store:[["none",this.app.i18n._("None")],["tls",this.app.i18n._("TLS")],["ssl",this.app.i18n._("SSL")]]},a),Ext.applyIf({fieldLabel:this.app.i18n._("Authentication"),name:"smtp_auth",value:"login",store:[["none",this.app.i18n._("None")],["login",this.app.i18n._("Login")],["plain",this.app.i18n._("Plain")]]},a),{name:"smtp_primarydomain",fieldLabel:this.app.i18n._("Primary Domain"),xtype:"textfield"},{name:"smtp_secondarydomains",fieldLabel:this.app.i18n._("Secondary Domains (comma separated)"),xtype:"textfield"},{name:"smtp_from",fieldLabel:this.app.i18n._("Notifications service address"),xtype:"textfield"},{name:"smtp_username",fieldLabel:this.app.i18n._("Notification Username"),xtype:"textfield"},{name:"smtp_password",fieldLabel:this.app.i18n._("Notification Password"),inputType:"password",xtype:"textfield"},{name:"smtp_name",fieldLabel:this.app.i18n._("Notifications local client (hostname or IP address)"),xtype:"textfield",value:"localhost"},{id:this.smtpBackendIdPrefix+"CardLayout",layout:"card",activeItem:this.smtpBackendIdPrefix+"standard",border:false,width:"100%",defaults:{border:false},items:[{id:this.smtpBackendIdPrefix+"standard",layout:"form",items:[]},{id:this.smtpBackendIdPrefix+"ldap_smtp_mail",layout:"form",items:[]},{id:this.smtpBackendIdPrefix+"postfix",layout:"form",autoHeight:"auto",defaults:{width:300,xtype:"textfield"},items:this.getDbConfigFields("smtp","postfix")},{id:this.smtpBackendIdPrefix+"ldap_smtp",layout:"form",autoHeight:"auto",defaults:{width:300,xtype:"textfield"},items:[]},{id:this.smtpBackendIdPrefix+"ldap_smtp_qmail",layout:"form",autoHeight:"auto",defaults:{width:300,xtype:"textfield"},items:[]}]}]},{title:this.app.i18n._("SIEVE"),id:"setup-sieve-group",checkboxToggle:true,collapsed:true,items:[{name:"sieve_hostname",fieldLabel:this.app.i18n._("Hostname"),xtype:"textfield"},{name:"sieve_port",fieldLabel:this.app.i18n._("Port"),xtype:"numberfield"},Ext.applyIf({fieldLabel:this.app.i18n._("Secure Connection"),name:"sieve_ssl",value:"none",store:[["none",this.app.i18n._("None")],["tls",this.app.i18n._("TLS")],["ssl",this.app.i18n._("SSL")]]},a)]}]},applyRegistryState:function(){this.action_saveConfig.setDisabled(!this.isValid())},getDbConfigFields:function(c,a){var b=(this.showType)?(Ext.util.Format.capitalize(a)+" "):"";return[{name:c+"_"+a+"_host",fieldLabel:b+this.app.i18n._("MySql Hostname")},{name:c+"_"+a+"_dbname",fieldLabel:b+this.app.i18n._("MySql Database")},{name:c+"_"+a+"_username",fieldLabel:b+this.app.i18n._("MySql User")},{name:c+"_"+a+"_password",fieldLabel:b+this.app.i18n._("MySql Password"),inputType:"password"},{name:c+"_"+a+"_port",fieldLabel:b+this.app.i18n._("MySql Port"),value:3306}]},getDovecotExtraConfig:function(b){var a=(this.showType)?"Dovecot ":"";return[{name:b+"_dovecot_uid",fieldLabel:a+this.app.i18n._("User or UID")},{name:b+"_dovecot_gid",fieldLabel:a+this.app.i18n._("Group or GID")},{name:b+"_dovecot_home",fieldLabel:a+this.app.i18n._("Home Template")},{fieldLabel:a+this.app.i18n._("Password Scheme"),name:b+"_dovecot_scheme",typeAhead:false,triggerAction:"all",lazyRender:true,editable:false,mode:"local",xtype:"combo",listWidth:300,value:"PLAIN-MD5",store:[["PLAIN-MD5",this.app.i18n._("PLAIN-MD5")],["MD5-CRYPT",this.app.i18n._("MD5-CRYPT")],["SHA",this.app.i18n._("SHA1")],["SHA256",this.app.i18n._("SHA256")],["SSHA256",this.app.i18n._("SSHA256")],["SHA512",this.app.i18n._("SHA512")],["SSHA512",this.app.i18n._("SSHA512")],["PLAIN",this.app.i18n._("PLAIN")]]}]}});